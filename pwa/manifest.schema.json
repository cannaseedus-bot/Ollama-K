{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mx2lm.app/schema/manifest.json",
  "title": "K'UHUL Boot Manifest Schema",
  "description": "Validates both minimal boot manifest and full expanded manifest for K'UHUL Pi Kernel",
  "type": "object",
  "required": [
    "@version",
    "@law",
    "@codex",
    "@boot",
    "@pi",
    "@pi_kernels",
    "@control",
    "@flow",
    "@scx",
    "@dict",
    "@runtime"
  ],

  "properties": {
    "@version": {
      "type": "object",
      "required": ["epoch", "policy_hash"],
      "properties": {
        "epoch": { "type": "integer", "minimum": 0 },
        "policy_hash": { "type": "string", "minLength": 8 },
        "compat": { "type": "string" }
      },
      "additionalProperties": false
    },

    "@law": {
      "type": "object",
      "required": ["axioms"],
      "properties": {
        "axioms": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1,
          "contains": {
            "enum": [
              "ALL_EXECUTION_IS_DETERMINISTIC",
              "NO_BRANCH_WITHOUT_PROOF",
              "FOLDS_ARE_TOKENIZERS"
            ]
          }
        }
      },
      "additionalProperties": false
    },

    "@codex": {
      "type": "object",
      "required": ["glyphs", "pi_kernels"],
      "properties": {
        "glyphs": { "type": "string" },
        "pi_kernels": { "type": "string" }
      },
      "additionalProperties": false
    },

    "@boot": {
      "type": "object",
      "required": ["initial_tick", "entropy_seed"],
      "properties": {
        "initial_tick": { "type": "integer", "minimum": 0 },
        "entropy_seed": { "type": "number" }
      },
      "additionalProperties": false
    },

    "@identity": {
      "type": "object",
      "properties": {
        "cluster_id": { "type": "integer", "minimum": 1 }
      },
      "additionalProperties": true
    },

    "@pi": {
      "type": "object",
      "required": ["state", "tokens"],
      "properties": {
        "state": {
          "type": "object",
          "required": ["entropy", "tick", "cluster_count"],
          "properties": {
            "entropy": { "type": "number", "minimum": 0 },
            "tick": { "type": "integer", "minimum": 0 },
            "cluster_count": { "type": "integer", "minimum": 1 }
          },
          "additionalProperties": false
        },
        "tokens": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["glyph", "w"],
            "properties": {
              "glyph": { "type": "string", "minLength": 1 },
              "w": { "type": "number" }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    },

    "@pi_kernels": {
      "type": "object",
      "required": ["layout", "kernels"],
      "properties": {
        "layout": { "type": "string", "pattern": "^[0-9]+x[0-9]+$" },
        "kernels": {
          "type": "array",
          "minItems": 28,
          "maxItems": 28,
          "items": { "type": "string" }
        }
      },
      "additionalProperties": false
    },

    "@control": {
      "type": "object",
      "required": ["xcfe", "branch_gate"],
      "properties": {
        "xcfe": { "type": "boolean", "const": true },
        "branch_gate": {
          "type": "object",
          "required": ["requires"],
          "properties": {
            "requires": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "@flow": {
      "type": "object",
      "required": ["sek"],
      "properties": {
        "sek": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        }
      },
      "additionalProperties": false
    },

    "@scx": {
      "type": "object",
      "required": ["version", "container"],
      "properties": {
        "version": { "type": "string", "const": "SCXQ2" },
        "container": { "type": "string", "const": "SCX2" },
        "dict_mode": { "type": "string" }
      },
      "additionalProperties": false
    },

    "@dict": {
      "type": "object",
      "required": ["format", "hash"],
      "properties": {
        "format": { "type": "string", "const": "SCX2_DICT_V1" },
        "hash": { "type": "string" }
      },
      "additionalProperties": false
    },

    "@runtime": {
      "type": "object",
      "required": ["kernel"],
      "properties": {
        "kernel": { "type": "string" },
        "target": { "type": "string" }
      },
      "additionalProperties": false
    },

    "@shards": {
      "type": "object",
      "description": "User-configurable backend shards for Google and Supabase",
      "properties": {
        "enabled": { "type": "boolean" },
        "backends": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "type"],
            "properties": {
              "id": { "type": "string" },
              "type": { "type": "string", "enum": ["google", "supabase", "custom"] },
              "config": { "type": "object" }
            }
          }
        }
      }
    },

    "@gas": {
      "type": "object",
      "description": "Gas files configuration - user-addable execution units",
      "properties": {
        "enabled": { "type": "boolean" },
        "builtin": {
          "type": "array",
          "items": { "type": "string" }
        },
        "user": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  },

  "additionalProperties": true
}
